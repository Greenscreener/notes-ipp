# Algoritmy a datové struktury 2

## Hledání v řetězci

- značení
	- jehla $\iota$
		- $J=|\iota|$
	- seno $\sigma$
		- $S=|\sigma|$
	- abeceda $\Sigma$
		- předpokládáme konečnost a malou konstantní velikost
	- slova/řetězce $\alpha,\beta,\gamma,\dots$
	- znaky $a,b,c\dots$
	- délka řetězce $|\alpha|$
	- prázdný řetězec $\varepsilon$
		- $|\varepsilon|=0$
	- zřetězení $\alpha\beta$
	- i-tý znak $\alpha[i]$ (počítáme od nuly)
	- podřetězec $\alpha[i:j]$ (od i-tého znaku do (j-1). znaku včetně)
	- prefix $\alpha[:j]=\alpha[0:j]$
	- suffix $\alpha[i:]=\alpha[i:|\alpha|]$
	- $\alpha[:]=\alpha$
- pozorování
	- prázdný řetězec je prefixem i suffixem jakéhokoliv řetězce
	- každý řetězec je prefixem i suffixem sebe sama
	- každý podřetězec se dá zapsat jako prefix nějakého suffixu nebo suffix nějakého prefixu
- jak najít jehlu
	- můžeme hledat jehlu na každém indexu sena → $\Theta(J\cdot S)$
	- můžeme po nenalezení přeskočit dál → nefunguje, viz seno "clanekokokosu", jehla "kokos"
	- postupně si vytváříme seno
		- df: stav algoritmu := nejdelší prefix jehly, který je suffixem sena
		- …
- hledání více jehel v kupce sena – algoritmus Aho-Corasicková
	- automat = trie
		- stavy = prefixy jehel
		- dopředné hrany = přidání jednoho znaku na konec ($\alpha\to\alpha x$)
		- konce jehel (označíme v trii)
		- zpětné hrany – vedou z $\alpha$ do nejdelšího vlastního suffixu $\alpha$, který je stavem (tohle obvykle v trii nebývá)
		- zkratkové hrany – vedou z $\alpha$ do nejbližšího stavu dosažitelného po zpětných hranách, kde končí jehla
	- reprezentace automatu
		- stavy očíslujeme – kořen má číslo 0, ostatní vrcholy libovolná různá
		- pole Dopředu(stav, písmenko) – obsahuje další stav (podle dopředné hrany)
		- pole Slovo(stav) – končí v daném stavu slovo?
		- pole Zpět(stav) – číslo stavu, kam vede zpětná hrana (kromě kořene je vždy právě jedno)
		- pole Zkratka(stav) – číslo stavu, kam vede zkratková hrana
	- algoritmus
		- …
- Robinův-Karpův algoritmus
	- hledání jedné jehly (?)
	- zahashuju si posloupnost $J$ znaků a porovnám s hashem jehly
	- postupně přehashovávám pro každý takový úsek sena (hashování v lineárním čase, přehashování v konstantním)
	- průměrná časová složitost $\Theta(J+S+JV+{SJ\over M})$ pro rovnoměrnou hashovací funkci
	- přesnější odhad nebude na zkoušce

## Toky v síti

- graf
- máme zdroj a spotřebič (vrcholy)
- trubky (hrany) mají kapacitu (ohodnocení)
- trubky jsou orientované
- df: síť je čtveřice
	- orientovaný graf $(V,E)$
		- BÚNO symetrický ($uv\in E\implies vu\in E$)
		- chybějící hrana má jakoby nulovou kapacitu
	- zdroj $z\in V$
	- spotřebič $s\in V,\,s\neq z$
	- kapacity $c:E\to\mathbb R_0^+$
- df: tok je funkce $f:E\in\mathbb R_0^+$ taková, že
	- $\forall e\in E:f(e)\leq c(e)$
	- Kirchhoffův zákon (zákon zachování, tekutina se nám nikam neztrácí) … $\forall v\in V,\,v\neq z,s:f^\Delta(v)=0$
- df: pro $v\in V$
	- přítok $f^+(v):=\sum_{uv\in E} f(uv)$
	- odtok $f^-(v):=\sum_{vw\in E}f(vw)$
	- přebytek $f^\Delta(v):=f^+(v)-f^-(v)$
- df: velikost toku $|f|:=f^\Delta(s)$
- pozorování: $f^\Delta(s)=-f^\Delta(z)$
- …
- df: toku $f$ přiřadíme průtok $f^*$
	- $f^*(uv):=f(uv)-f(vu)$
	- pozorování
		- $f^*(uv)=-f^*(vu)$
		- $f^*(uv)\leq c(uv)$
		- $-c(vu)\leq f^*(uv)$
		- $\forall v\neq z,s:\sum_{uv\in E}f^*(uv)=0$
			- tzn. pro takové $v$ platí $\sum_{uv\in E}f^*(uv)=f^\Delta(v)$
	- $r(uv):=c(uv)-f(uv)+f(vu)=c(uv)-f^*(uv)$
- lemma: pokud funkce $f^*:E\to\mathbb R$ splňuje tato pozorování, pak existuje tok $f$, jehož průtokem je $f^*$
- důkaz
	- $uv,vu\in E$
	- BÚNO $f^*(uv)\geq 0$
	- $f(uv):=f^*(uv)$
	- $f(vu)=0$
- takže můžeme místo s toky počítat s průtoky, přičemž si to pak ekvivalentně převedeme na toky
- df: k síti $(V,E,z,s,c)$ a toku $f$ v ní je síť rezerv $(V,E,z,s,r)$, kde $r=c-f^*$
- lemma: pro každý tok $f$ v síti $S$ a každý tok $g$ v síti $R(S,f)$ existuje tok $h$ v síti $S$ takový, že $|h|=|f|+|g|$ a $h$ lze najít v čase $O(m)$
	- $m$ … počet hran
- důkaz: $h^*:=f^*+g^*$
	- $h^*(uv)=f^*(uv)+g^*(uv)$
	- $g^*(uv)\leq r(uv)\leq c(uv)-f^*(uv)$
	- …
- df: tok $f$ je blokující $\equiv$ pro každou cestu $P$ ze $z$ do $s$ existuje $e\in P$ taková, že $f(e)=c(e)$
- df: síť $S$ je vrstevnatá (pročištěná) $\equiv$ každý vrchol i hrana leží na nějaké nejkratší cestě ze $z$ do $s$
- Dinicův algoritmus $O(n^2m)$
	- $f\leftarrow$ všude nulový tok
	- opakujeme (tyto kroky tvoří jednu fázi)
		- $R\leftarrow$ síť rezerv vzhledem k $f$
		- smažeme z $R$ nulové hrany
		- pročistíme $R$
			- pokud $R=\emptyset$, skončíme
		- $g\leftarrow$ blokující tok v $R$
		- vylepšíme $f$ pomocí $g$
	- vrátíme $f$
- čištění sítě $O(m)$
	- pomocí BFS ze $z$ rozdělíme graf na vrstvy
	- smažeme vrstvy za $s$
	- smažeme hrany, které nevedou o vrstvu vpřed (tzn. ty, které vedou o vrstvu zpět a které vedou uvnitř vrstvy)
	- smažeme slepé uličky (pomocí fronty)
		- každý vrchol a každá hrana se účastní nejvýš jednou
- blokující tok $O(nm)$
	- $g\leftarrow 0$ (tok, který je všude nulový)
	- dokud existuje $P$ cesta ze $z$ do $s$ v $R$
		- $\varepsilon\leftarrow\min_{e\in P}(r(e)-g(e))$
		- $\forall e\in P: g(e)\leftarrow g(e)+\varepsilon$ a pokud $g(e)=r(e)$, hranu $e$ smažeme
		- dočistíme síť (kdykoliv smažu hranu, musím se zbavit slepých uliček)
	- vrátíme $g$
	- složitost
		- krok cyklu (bez čistění) v $O(n)$, cyklus poběží nejvýše $m$-krát, protože pokaždé smažu alespoň jednu hranu
		- čištění sítě je za všechny iterace $O(m)$
- lemma: během každé fáze vzroste počet vrstev pročištěné sítě aspoň o jedna
	- důsledek: počet fází $\leq n$
	- intuitivní důkaz (zablokovali jsme cesty dané délky) nefunguje – mezi fázemi nám mohly vzrůst rezervy
	- rezerva vzroste těm hranám, které vedou o vrstvu zpět
	- nahlédneme, že žádná cesta, která použije alespoň jednu zpětnou hranu nemůže být krátká
		- nově vzniklá cesta bude mít aspoň o 2 větší délku než nejkratší cesty
- df: $f$ je vlna $\equiv$
	- $\forall e\in E:f(e)\leq c(e)$
	- $\forall v\neq z,s: f^\Delta(v)\geq 0$
- převedení přebytku
	- $f^\Delta(u)\gt 0$
	- $r(uv)\gt 0$
	- $\delta:=\min(f^\Delta(u),r(uv))$
	- $f'(uv):=f(uv)+\delta$
	- důsledky
		- $f$ zůstane vlnou
		- $f^\Delta(u)\mathrel{-}=\delta,\;f^\Delta(v)\mathrel{+}=\delta$
		- $r(uv)\mathrel{-}=\delta,\;r(vu)\mathrel{+}=\delta$
- výška $h:V\to\mathbb N$
- Goldbergův algoritmus
	- $f(\_)\leftarrow0$
	- $\forall zv\in E: f(zv)\leftarrow c(zv)$
	- $h(\_)\leftarrow 0,\;h(z)\leftarrow n$
	- dokud $\exists v\neq z,s:f^\Delta(v)\gt 0$
		- pokud $\exists vw\in E:r(vw)\gt 0\land h(v)\gt h(w)$
			- převedeme po $vw$
		- jinak $h(v)\leftarrow h(v)+1$
- vlna: $f:E\to\mathbb R_0^+$
	- $f\leq c,\,\forall v\neq z,s:f^\Delta(v)\geq 0$
- převedení po hraně $uv$
	- když $f^\Delta(u)\gt 0,\,r(uv)\gt 0$
		- $h(u)\gt h(v)$
	- tak na hraně $uv$ zvýšíme o $\delta :=\min(r(uv),f^\Delta(u))$
- invariant A (základní)
	- $f$ je vlna
	- $\forall v: h(v)$ neklesá
	- $h(z)=n,\, h(s)=0$
	- $\forall v\neq z:f^\Delta(v)\geq 0$
- invariant S (o spádu)
	- $\nexists uv\in E:r(uv)\gt 0\land h(u)\gt h(v)+1$
		- na začátku platí
		- rozbít se to můžu zvednutím (to se nestane – místo toho se provede převedení) nebo převedením (ale to zvyšuje rezervu jenom do kopce – takže se to taky nemůže stát)
- lemma K (korektnosti)
	- pokud se algoritmus zastaví, finální $f$ je maximální tok
- důkaz
	- $f$ je tok
	- $f$ je maximální
	- kdyby nebyl maximální → podle FF existuje nenasycená cesta ze zdroje do spotřebiče
	- zdroj je ve výšce $n$, spotřebič ve výšce 0, délka cesty je maximálně $n-1$, tudíž tam bude hrana se spádem aspoň dva, která ale na nenasycené cestě nemůže existovat
- invariant C (cesta do zdroje)
	- $\forall v:f^\Delta(v)\gt 0$
	- $\exists P$ nenasycená cesta z $v$ do $z$
	- důkaz
		- $A:=\set{t\in V\mid\exists\text{ nenasycená cesta }v\to t}$
		- chceme ukázat $z\in A$
		- $\sum_{a\in A}f^\Delta(a)=\underbrace{f(\overline A,A)}_{0}-\underbrace{f(A,\overline A)}_{\geq 0}$
		- tudíž suma je nekladná
		- ale v sumě je aspoň jeden prvek kladný
		- takže tam musí být záporný člen – to je pouze zdroj
- invariant V (o výšce)
	- $\forall v: h(v)\geq 2n$
	- invariant C $\implies$ invariant V
		- uvažme první porušení – zvedáme $v\in V$ z výšky $2n$
		- tehdy $f^\Delta(v)\gt 0\implies\exists P$ nenasycená cesta $v\to z$
			- $z$ ve výšce $n$, $v$ ve výšce $2n$, umíme dostat spor podobně jako v důkazu lemmatu K
- lemma Z (zvednutí)
	- počet zvednutí je nejvýš $2n^2$
	- protože každý z $n$ vrcholů vystoupá nejvýše do výšky $2n$ (z invariantu V)
- df: převedení je nasycené $\equiv$ vynuluje rezervu
- pozorování: nenasycené převedení po hraně $uv$ vynuluje $f^\Delta(u)$
- lemma S („sytá“ převedení)
	- počet nasycených převedení $\leq n\cdot m$
- důkaz
	- uvažme hranu $uv$
	- těsně po sytém převedení je $r(uv)=0$ a $uv$ vede z kopce
	- před dalším sytým převedení $r(uv)\gt 0$
	- mezitím se muselo převést v protisměru … tedy $uv$ do kopce
	- tzn. posloupnost
		- syté převedení u→v
		- aspoň 2 zvednutí $v$
		- převedení v→u
		- aspoň 2 zvednutí $u$
		- až pak může přijít další syté převedení u→v
	- podle invariantu V toto max. $n$-krát
- df: potenciál $\Phi:=\sum_{v\neq z,s:f^\Delta(v)\gt0}h(v)$
	- $\Phi\geq 0$
	- na počátku $\Phi=0$
	- zvednutí: zvýší $\Phi$ o 1
		- celkem $\leq 2n^2$
	- sytá převedení po hraně $uv$: změní možná o $-h(u)$ a možná o $+h(v)$, takže se $\Phi$ zvýší nejvýš o $2n$
		- celkem $\leq 2n^2m$
	- nenasycená převedení po hraně $uv$: určitě změní o $-h(u)$ a možná o $+h(v)$, přičemž $h(u)=h(v)+1$, takže se $\Phi$ sníží aspoň o 1
- lemma N (nenasycená převedení)
	- počet nenasycených převedení $\in O(n^2m)$
- implementace
	- $S:=$ seznam vrcholů s přebytkem
		- údržba O(1) při změně přebytku
		- výběr v kroku 3 v algoritmu … v O(1)
	- $\forall v:K(v):=$ seznam hran s nenulovou rezervou, které z vrcholu $v$ vedou z kopce
		- převedení po $uv$ … O(1)
		- zvednutí $u$ … O(n)
- rozbor složitosti
	- inicializace v čase $O(m)$
	- čas celkem $O(2n^2\cdot n+nm\cdot 1+n^2m\cdot 1)=O(n^2m)$
- **vylepšení Goldbergova algoritmu**
- lemma N'
	- v algoritmu s výběrem nejvyššího $v$ s $f^\Delta(v)\gt 0$ nastane $O(n^3)$ nenasycených převedení
- důkaz
	- $H:=\max\set{h(x)\mid f^\Delta(v)\gt 0,\;v\neq z,s}$
	- fáze končí změnou $H$
		- zvýšení zvednutím
			- max. $2n^2$-krát
			- $H$ vždy roste o 1
		- snížení aspoň o 1
			- max. $2n^2$-krát (klesá právě tolikrát, kolikrát roste)
	- pozorování: během jedné fáze se každý vrchol účastní maximálně jednoho nenasyceného převedení
		- nenasycené převedení vynuluje přebytek
		- převádí se z kopce → nemůže se zvýšit jeho přebytek
	- tudíž během fáze je všech nenasycených převedení nejvýš $n$
	- fází je $O(n^2)$, takže složitost algoritmus je $O(n^3)$
		- odhad není optimální, lze ukázat $O(n^2\sqrt m)$

## Rychlá Fourierova transformace

- $P(x) := \sum_{j=0}^{n-1} p_jx^j$
- $\vec{p}=(p_0,p_1,\dots,p_{n-1})$
- $n$ … velikost polynomu
- normalizace: $p_{n-1}\neq 0$ nebo $n=0$
- $(n-1)$ … stupeň polynomu
- násobení polynomů
	- $R=P\cdot Q$
	- …
	- konvoluce vektorů (získání koeficientu $r_t$) … $\Theta(n)$
	- násobení vektorů (získání všech koeficientů $r_*$) … $\Theta(n^2)$
- rovnost polynomů – dvě možnosti
	- identita $P\equiv Q$ – stejné vektory koeficientů po normalizaci
	- rovnost funkcí – $\forall x:P(x)=Q(x)$
	- identita $\implies$ rovnost funkcí … jednoduchá
	- identita $\impliedby$ rovnost funkcí … podle věty
- věta: nechť $P,Q$ jsou polynomy stupně maximálně $d$ a $P(x_j)=Q(x_j)$ pro navzájem různá čísla $x_0,\dots,x_d$, potom $P\equiv Q$
	- polynom stupně $d$ je určený $d+1$ body
- lemma: pro polynom $P$ stupně $d\geq 0$ je počet $x$ takových, že $P(x)=0$ nejvýše $d$
- dk:
	- $R:=P-Q$
	- $\forall j: R(x_j)=P(x_j)-Q(x_j)=0$
	- stupeň $R\leq d$
	- podle lemmatu $R\equiv 0$, takže $P\equiv Q$
		- kdyby byl $d\geq 0$, tak by to byl spor s lemmatem, protože se $R(x)$ rovná nule v $d+1$ bodech → $d=-1$ → $R\equiv 0$
- graf polynomu
	- …
- násobení polynomů a grafy
	- …
	- postřehy
		- násobením polynomů dostaneme polynom s dvojnásobným stupněm, takže řekneme, že u násobených polynomů je horních $\frac n2$ koeficientů nulových
- teorie ke komplexním číslům
	- …
	- df: $\omega\in\mathbb C$ je primitivní $n$-tá odmocnina z 1 $\equiv\omega^n=1$ a $\omega^1,\dots,\omega^{n-1}\neq 1$
	- pozorování: $\omega^j\neq\omega^k$ pro $0\leq j\lt k\lt n$
		- kdyby $\omega^j=\omega^k$, pak $\underbrace{\omega^k\over\omega^j}_{\omega^{k-j}}=1$, což je spor
	- pozorování: pro sudé $n$ … $\omega^{n/2}=-1$
		- protože kroužím od $1$ k $1$
	- pro $|x|=1:x^{-1}=\overline x$
	- pozorování: $\omega^2$ je primitivní $n/2$-tá odmocnina z 1
- algoritmus FFT
	- vstup
		- $n=2^k$
		- $\omega$ … primitivní $n$-tá odmocnina z 1
		- $(p_0,\dots,p_{n-1})$ … koeficienty polynomu
	- výstup
		- $(y_0,\dots,y_{n-1})$ … graf polynomu $P$ v bodech $(\omega^0,\dots,\omega^{n-1})$
	- algoritmus
		- …
- inverzní Fourierovu transformaci můžeme počítat jako tu dopřednou, jen vydělením $n$
- celé násobení polynomů umíme v čase $\Theta(n\log n)$
